<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Ajatko taloudellisesti?</title>
		<link rel="stylesheet" href="style.css" />
		<script src="js/jquery.min.js"></script>
	</head>
	<body>
		<h2>Ajatko taloudellisesti?</h2>
		<div id="startScreen">
			<button id="startButton" onclick="startGame()">Aloita</button>
		</div>
		<div id="gameScreen">
			<div id="question"></div>
			<div id="answerOptions"></div>
			<div id="fuelStatus" style="border: 1px solid #184161; width: 100%;">
				
			</div>
		</div>
		<div id="resultScreen">
			Game Over
			<button id="startButton" onclick="startGame()">Kokeile uudelleen</button>
		</div>
		<script type="text/javascript">
			var questNum;
			var correctAnswers;
			var fuel;
			var timer;

			$(function(){
				$("#gameScreen").hide();
				$("#resultScreen").hide();
			});

			function startGame(){
				$("#startScreen").hide();
				$("#resultScreen").hide();
				$("#gameScreen").show();
				questNum = -1;
				correctAnswers = 0;
				fuel = 50;
				startTimer();
				$("#fuelStatus").html('<div style="width: 50%; background-color: #90E050; text-align: center; border-right: 1px solid #006600;">50%</div>');
				getQuestion();
			}

			function startTimer() {
				timer=self.setInterval(function(){watchTime()},1000);
			}

			function watchTime() {
				console.log("watchTime");
				fuel-=2;
				updateFuel(fuel);
				if (fuel < 0) {
					endGame();
				}
			}

			function getQuestion(){
				questNum++;
				var a = 0;
				$("#answerOptions").empty();
				$.getJSON("questions.json", function(data){
					console.log("qNum: "+questNum);
					$("#question").text(data[questNum].question);
					while (data[questNum].answerOptions.length > a) {
						/*$("<button>", {
						"text": data[questNum].answerOptions[a].option,
						"class": "answerOption",
						click: function() {
							console.log(data[questNum].answerOptions[a].option+" : "+data[questNum].rightAnswer);
							checkAnswer(data[questNum].answerOptions[a].option, data[questNum].rightAnswer);
						}
						}).appendTo("#answerOptions");*/
						$("#answerOptions").append('<button class="answerOption"	onclick="checkAnswer(\''+data[questNum].answerOptions[a].option+'\', \''+data[questNum].rightAnswer+'\')">'+data[questNum].answerOptions[a].option+'</button>');
						a++;
					}
				});
			}

			function checkAnswer(playerAnswer, rightAnswer) {
				console.log(playerAnswer+" == "+rightAnswer);				
				if (playerAnswer == rightAnswer && fuel > 0) {
					correctAnswers++;
					fuel+=10;
					updateFuel(fuel);
					console.log("correct :"+(questNum+1)+"/"+correctAnswers);
					getQuestion();
				} else {
					fuel-=10;
					updateFuel(fuel);
					console.log("failed, fuel: "+fuel);
					var end = (fuel > 0) ? getQuestion() : endGame();
				}
			}

			function updateFuel(f) {
				$("#fuelStatus").html('<div id="fuelStatus" style="width: '+f+'%; background-color: #90E050; text-align: center; border-right: 1px solid #006600;">'+f+'%</div>');
			}

			function endGame() {
				$("#startScreen").hide();
				$("#gameScreen").hide();
				$("#resultScreen").show();
				timer=window.clearInterval(timer);
			}
			
		</script>
	</body>
</html>
