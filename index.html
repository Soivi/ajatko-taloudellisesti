<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Ajatko taloudellisesti?</title>
		<link rel="stylesheet" href="style.css" />
	</head>
	<body>

		<div id="startScreen">
			<a href="javascript:start()"><div class="startGame"></div></a>
			<!-- <button id="startButton" onclick="start()">Aloita</button> -->
		</div>

		<div id="gameScreen">
			<div class="fuel"></div>
			<div class="questions">
				<div id="question"></div>
				<div id="answerOptions"></div>
			</div>
			<div id="fuelStatus" style="border: 1px solid #184161; width: 100px; height:400px;"></div>
		</div>

		<div id="resultScreen"></div>

		<script src="js/jquery.min.js"></script>
		<script type="text/javascript">
			var game;

			$(function(){
				game = new Game();
				game.showStartScreen();
			});

			function start() {
				game.startGame();
			}

			function Game() {
				this.questNum;
				this.correctAnswer;
				this.fuel;
				this.timer;
				this.questionFactory;
				this.score;
				this.fuelConsumption;
				this.trip;

				this.startGame = startGame;
				this.watchTime = watchTime;
				this.checkAnswer = checkAnswer;
				this.updateFuel = updateFuel;
				this.endGame = endGame;
				this.showStartScreen = showStartScreen;
				this.showGameScreen = showGameScreen;
				this.showResultScreen = showResultScreen;

				function startGame() {
					showGameScreen();
					questNum = -1;
					correctAnswers = 0;
					fuel = 100;
					fuelConsumption = 2;
					score = 0;
					trip = 0;
					timer=self.setInterval(function(){watchTime()},100);
					updateFuel();

					questionFactory = new QuestionFactory();
					questionFactory.buildQuestions();
					questionFactory.scrambleList();
					getQuestion();
				}

				function watchTime() {
					this.fuel-=fuelConsumption;
					updateFuel();
					if (fuel < 0) {
						endGame();
					}
					this.trip+=3.333333;
				}

				function checkAnswer(playerAnswer, rightAnswer) {
					if (playerAnswer == rightAnswer) {
						correctAnswers++;
						score+=100;
						fuelConsumption-=0.5;
						//moreFuel();
					} else {
						fuelConsumption+=0.5;
						//reduceFuel();
					}
					console.log("kulutus: "+fuelConsumption);
					updateFuel();
					var end = (fuel < 0) ? endGame() : getQuestion();
				}

				function updateFuel() {
					$("#fuelStatus").html('<div id="fuelStatus" style="height: '+this.fuel+'%; background-color: #90E050; text-align: center; border-right: 1px solid #006600;">'+this.fuel+'%</div>');
				}

				function moreFuel() {
					if ((this.fuel+10) >= 100) {
						this.fuel = 100;
					} else {
						this.fuel+=10;
					}
				}

				function reduceFuel() {
					this.fuel-=10;
					if (fuel < 0) { endGame(); }
				}

				function showStartScreen() {
					$("#startScreen").show();
					$("#gameScreen").hide();
					$("#resultScreen").hide();
				}

				function showGameScreen() {
					$("#startScreen").hide();
					$("#gameScreen").show();
					$("#resultScreen").hide();
				}

				function showResultScreen() {
					$("#startScreen").hide();
					$("#gameScreen").hide();
					$("#resultScreen").show();
				}

				function endGame() {
					$("#resultScreen").empty();
					showResultScreen();
					$("#resultScreen").append('<div class="result">Matka: '+this.trip.toFixed(2)+' metri√§</div>');
					$("#resultScreen").append('<a href="javascript:start()"><div class="startGame"></div></a>');
					timer=window.clearInterval(timer);
				}

				function getQuestion(){
					this.questNum++;
					console.log(questionFactory.questionsList.length);
					if (questNum >= questionFactory.questionsList.length) {
						endGame();
					} else {
						$("#answerOptions").empty();
						$("#question").text(questionFactory.questionsList[this.questNum].question); // print question

						// Loop answer options
						for (a=0;questionFactory.questionsList[this.questNum].answerOptions.length>a;a++) {
							$("#answerOptions").append('<div class="answerOption" onclick="game.checkAnswer(\''+questionFactory.questionsList[this.questNum].answerOptions[a]+'\', \''+questionFactory.questionsList[this.questNum].rightAnswer+'\')">'+questionFactory.questionsList[this.questNum].answerOptions[a]+'</button>');
						}
					}
				}

			}

			function QuestionFactory() {
				this.questionsList = new Array();

				this.buildQuestions = buildQuestions;

				function buildQuestions() {
					var list = new Array();
					$.ajax({
						url: 'questions.json',
						dataType: 'json',
						async: false,
						success: jsonCallback
					});

					function jsonCallback(data) {
						for (i=0;data.length>i;i++) {
							var qlist = new Array();
							list[i] = new Question();
							list[i].id = i;
							list[i].question = data[i].question;
							list[i].rightAnswer = data[i].rightAnswer;
							for (a=0;data[i].answerOptions.length>a;a++) {
								qlist[a] = data[i].answerOptions[a].option;
							}
							list[i].answerOptions = qlist;
						}
					}
					this.questionsList = list;
				}

				this.scrambleList = function() {
					for (i = 0; i < 1000; i++) {
						x = Math.floor(Math.random() * this.questionsList.length);
						y = Math.floor(Math.random() * this.questionsList.length);
						temp = this.questionsList[x];
						this.questionsList[x] = this.questionsList[y];
						this.questionsList[y] = temp;
					}
				}

			}

			function Question() {
				this.id;
				this.question;
				this.rightAnswer;
				this.answerOptions = new Array();
				this.setAnswerOptions = setAnswerOptions;

				function setAnswerOptions(answer) {
					answerOptions = answer;
				}
			}
		</script>
	</body>
</html>
